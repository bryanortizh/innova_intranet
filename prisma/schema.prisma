generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Tabla de cursos (existente)
model courses {
  id         Int       @id @default(autoincrement())
  title      String    @db.VarChar(255)
  cover      String    @db.VarChar(500)
  price      Decimal   @db.Decimal(10, 2)
  category   String    @db.VarChar(50)
  url        String?   @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamp(0)
  updated_at DateTime? @default(now()) @db.Timestamp(0)
}

// Enum para los roles de usuario
enum Role {
  PROFESOR
  ALUMNO
}

// Tabla de usuarios (profesores y alumnos)
model User {
  id        Int      @id @default(autoincrement())
  nombre    String   @db.VarChar(100)
  apellido  String   @db.VarChar(100)
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255) // Almacenado encriptado con bcrypt
  rol       Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tokens    Token[]

  @@map("users")
}

// Tabla de tokens para sesiones
model Token {
  id        Int       @id @default(autoincrement())
  token     String    @unique @db.VarChar(500)
  userId    Int
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  isValid   Boolean   @default(true) // false cuando cierra sesión
  expiresAt DateTime
  createdAt DateTime  @default(now())
  revokedAt DateTime? // Fecha cuando se invalidó el token (logout)

  @@map("tokens")
}
